<!--
CutMark - Photoshop UXP Plugin
Copyright (c) 2025 stechdrive
Released under the MIT license
-->
# CutMark ユーザーマニュアル

**CutMark** は Photoshop UXPプラグインです。日本の縦書き絵コンテ用紙のカットナンバー記入作業を効率化します。連番リネーム済みの画像を読み込み、マウスまたはキーボードショートカットでカット番号を配置し、PSD/JPG/PNG として書き出します。

---

## 1. インストール

1.  配布された `ccx` ファイルをダブルクリックし、Adobe Creative Cloud デスクトップアプリ経由でインストールします。
2.  Photoshop を起動し、メニューの **プラグイン > CutMark** を選択してパネルを開きます。

---

## 2. 基本的な使い方

### 2.1 準備
絵コンテ画像ファイル（JPG/PNG/PSD）をフォルダにまとめ、ファイル名をページ順の連番にします。

### 2.2 読み込みと開始
1.  **「ファイル」** セクションの **「フォルダ追加」** ボタンを押します。
2.  画像が入っているフォルダを選択します。
3.  **自動開始**: フォルダ内の画像がキューに追加され、**自動的に1枚目の画像が開きます**。
    *   ※ 既に作業中の場合や、履歴を表示している場合は自動開始しません。その場合は現在の作業を終えて「次へ」進むと、追加されたファイルが順次開かれます。
    *   **出力先**: フォルダから追加した場合、そのフォルダの中に `output` フォルダが自動で作られ、そこに保存されます。**「ファイル追加」** から読み込みをした場合は任意のフォルダを出力先として選択してください。

### 2.3 番号の配置
画像が開いたら、カット番号を配置します。

*   **行ボタン（1〜9）**: テンプレートで定義された位置（行）に番号を配置します。
    *   キーボードのテンキーまたは数字キー `1` 〜 `9` でも配置できます。
*   **選択範囲へ配置**: 画像上で選択ツール(M)で選択範囲を作成し、**「選択範囲へ配置」** ボタンを押すと、その中心に番号を配置します。これにより好きな位置にカット番号を配置できます。

> **配置を間違えた場合**
> 配置されるのは通常のレイヤーです。移動ツールで位置を直したり、レイヤーを削除してやり直したりできます。
> ※ やり直す際は、パネルの「次番号」を手動で戻してください。

### 2.4 保存して次へ
配置が終わったら、**「次へ」** ボタンを押します（または **`Enter`** キー）。
*   現在の画像が PSD(追加オプションでJPG/PNG) として保存され、閉じられます。
*   自動的に次の画像が開きます。
*   これを繰り返して最後の画像まで処理します。

---

## 3. 機能詳細

### 3.1 カット番号
*   **桁数**: 3桁または4桁を選択できます。
*   **次番号**: 次に配置される番号です。手動で書き換えることもできます。
*   **A-B分け**: 同じカット番号で差分を作る場合（`001A`, `001B`...）に使います。
    *   チェックを入れると、番号（数字）が進まなくなり、サブ文字（A, B...）を選択できるようになります。
    *   **自動進行**: サブ文字ありで配置すると、次は自動的に B, C... と進みます。
    *   **解除時の挙動**: チェックを外すと、自動的に数字が +1 されます（例: `001B` の後に解除 → `002`）。

### 3.2 背景・塗りつぶし
*   **塗りつぶし**: チェックを入れると、文字の下に白座布団（背景）を敷きます。
*   **範囲拡張**: 文字の周囲何ピクセルまで白くするかを指定します（0〜64px）。

### 3.3 テンプレート
各社コンテ用紙に合わせたテンプレートを作成して保存できます。

1.  **「テンプレート」** 
    *   現在使用中のテンプレートを使用テンプレから選べます。
    *   不要になったテンプレは削除ボタンで削除できます。
2.  **「新規テンプレート作成」** 
    *   **テンプレ名**: テンプレートの名前。
    *   **DPI**: 絵コンテの画像解像度。
    *   **行数**: 絵コンテの1ページあたりのコマ数。
    *   **位置サイズ (XYWH)**: 絵コンテ1行目のカット番号記入欄の左上の開始座標・幅と高さをピクセル値で指定します。絵コンテ画像を開いて選択ツールで選択範囲を作成し **「選択範囲からXYWH読取」** で入力することもできます。
    *   **フォント**: 現在選択されているフォント名です。**「フォント選択」** を開いて一覧からフォントを選択できます。
    *   **サイズ**: フォントサイズ（pt）。プリセット選択または数値直接入力（8〜50pt）。
    *   **余白**: カット番号を配置する範囲WHの内側余白を指定します。カット番号テキストの配置位置の微調整に使えます。不正な値は自動的に修正されます。
3.  **「保存」** 必要な情報がすべて入力されているとボタンを押せます。テンプレを保存し、使用テンプレリストに追加されます。

### 3.4 追加出力（JPG/PNG）
PSD 保存と同時に、JPG/PNG形式で画像を書き出せます。
*   **「ファイル」** セクションの **「追加出力」** を ON にします。
*   形式（JPG / PNG）を選択します。
*   「次へ」や「戻る」で保存する際、PSD と同じ場所に書き出されます。

### 3.5 履歴（戻る）
**「戻る」** ボタンで一つ前に保存したPSDファイルを開いて修正できます。
*   修正して保存し直すと、PSD と追加出力（ONの場合）が上書きされます。
*   最新まで進むと、通常のキュー処理に戻ります。

### 3.6 フォーカスインジケータ
パネル最上部にある **小さな円** は、クリックするとキーボードショートカットを有効にできます。
*   **点灯（色付き）**: パネルに内にマウスがあると点灯しています。
*   **消灯（薄い色）**: フォーカスが外れています。プラグインのキーボードショートカットは無効です。
*   Photoshopプラグインの仕様のため、プラグインから正確にフォーカス状態を確認することはできません。このインジケータは、アレ？キーボードショートカットがきかない？という時にクリックして、プラグインパネルに確実にフォーカスを移すためのものです。クリックしてもインジケータの表示はかわりません。

### 3.7 設定リセット
パネル上の **「リセット」** ボタンを押すと、設定や読み込み状態がすべて **起動直後の状態（初期状態）** に戻ります。
*   動作がおかしい場合や、最初から作業をやり直したい時に使用してください。

---

## 4. ショートカットキー

プラグインパネルにフォーカスがある時（インジケータ点灯時）に有効です。

| キー | 動作 | 備考 |
| :--- | :--- | :--- |
| **`1` 〜 `9`** | 指定行に配置 | テンプレ行数内のみ有効。テンキー可 |
| **`Enter`** | 次へ（保存して開く） | 　 |

※ テキストや数値入力中などは誤操作防止のため無効になります。
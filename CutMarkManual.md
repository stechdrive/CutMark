<!--
CutMark - Photoshop UXP Plugin
Copyright (c) 2025 stechdrive
Released under the MIT license
-->
# CutMark ユーザーマニュアル

**バージョン:** 1.1.0  
**対象アプリケーション:** Adobe Photoshop 2023 (Ver24.4.0) 以降 / 動作確認はPhotoshop 2026 (Ver27.0.0) で行っています

---

## 1. 概要
**CutMark** は、日本のアニメーション制作や映像制作における縦並びの「絵コンテ」に向けた、**カット番号記入支援プラグイン**です。

事前に定義された「テンプレート」に基づき、ショートカットキーひとつで所定の位置に連番を配置します。また、フォルダごとの連続処理（キュー）機能を備えており、大量の画像ファイルを開き、番号を打ち、保存して次へ進むというルーチンワークを高速化します。

---

## 2. インターフェース構成

パネルは上から順に以下のセクションで構成されています。

### 2.1 トップバー（フォーカスインジケータ）
パネル最上部の右側にある**小さな円**です。
*   **点灯（色付き）**: パネルがキーボードフォーカスを持っています。ショートカットキー（1〜9、Enter）が有効です。
*   **消灯（枠線のみ）**: パネルからフォーカスが外れています（キャンバス操作中など）。
    *   **操作:** この円をクリックすると、即座にパネルへフォーカスが戻ります。
*   **補足**: Photoshopの仕様の為、フォーカスの状態を確実にプラグインから捕捉することはできません。もしキーボードショートカットが効かない場合は、このインジケータをクリックしてください。インジケータの表示はクリックしても変わりませんが、フォーカスをプラグインに戻すことができます。

### 2.2 ステータス
現在の状況を表示します。
*   **次番号**: 次に打たれるカット番号（例: 001, 012A）。
*   **進捗**: キュー内の残りファイル数 / 全ファイル数。

### 2.3 カット番号記入
番号のルールや見た目を設定し、配置を実行するエリアです。
*   **桁数**: 3桁（001〜）または 4桁（0001〜）を選択。
*   **次番号**: 数値の変更（＋／−ボタンあり）。
*   **塗りつぶし**: テキストの下に白座布団（背景）を敷くかどうか。
    *   **範囲拡張(px)**: 文字サイズに対してどれくらい余白を持たせるか（0〜64px）。
*   **A-B分け（サブ文字）**: カット番号に枝番（A, B, C...）を付けるモード。
*   **配置ボタン（1コマ目〜Nコマ目）**: ボタンを押すとその行に配置されます。
*   **選択範囲に配置**: キャンバス上の選択範囲の中心に配置します。
*   **ナビゲーションボタン**: 「処理開始」「戻る」「保存して次へ」。

### 2.4 絵コンテ読み込み
作業対象のファイルを管理します。
*   **フォルダ追加 / ファイル追加**: 画像を読み込みキューに入れます。
*   **出力先設定 / クリア**: 保存先フォルダを指定します。
    *   既定では、読み込んだファイルの親フォルダ内に **`output`** フォルダが自動作成されます。
*   **追加出力 (JPG/PNG)**:
    *   **追加出力**: ONにすると、PSD保存と同時にラスタ画像も書き出します。
    *   **形式**: JPG (品質80) または PNG を選択できます。

### 2.5 使用テンプレート選択
用紙レイアウト（行数、文字位置、フォントなど）を切り替えます。
*   **使用テンプレ**: プリセットから選択。
*   **削除**: 現在選択しているテンプレートを削除します。
    *   ユーザー作成テンプレは完全に削除されます。
    *   内蔵テンプレは「非表示」になります（全削除時は内蔵既定が復活）。
*   **新規テンプレート作成**: 独自のレイアウトを作成して保存します。

---

## 3. 基本的なワークフロー

![CutMark 手順概要図](./img\CutMarkManual.jpg)

最も一般的な「フォルダ内の画像を順に処理する」手順です。

### 手順 1: 準備
1.  **「絵コンテ読み込み」** セクションを開きます。
2.  **「フォルダ追加」** をクリックし、素材が入っているフォルダを選択します。
    *   対応形式: `.jpg`, `.jpeg`, `.png`, `.psd`
    *   ※サブフォルダ内のファイルは読み込まれません（直下のみ）。
3.  **「出力先設定」** をクリックし、保存先のフォルダを指定します。
    *   *ヒント: 指定しない場合、元フォルダの中に自動的に `output` フォルダが作られ、そこに保存されます。*

### 手順 2: 開始
1.  **「カット番号記入」** セクションにある **「処理開始」** ボタンを押します。
2.  1枚目の画像が自動的に開きます。

### 手順 3: 配置
1.  **「カット番号記入」** セクションで **「次番号」** を確認します。
2.  配置したいコマの行に対応するキー、またはボタンを押します。
    *   **キーボードの `1` 〜 `9`**: 対応する行（1コマ目〜9コマ目）に配置。
    *   **「選択範囲に配置」**: 選択範囲(M)ツール等で囲った範囲の中心に配置。
3.  配置されると、自動的に**次番号が +1** されます。

### 手順 4: 次のファイルへ
1.  作業が終わったら、キーボードの **`Enter`** キー（またはパネルの「保存して次へ」）を押します。
2.  現在のファイルが PSD として保存され、自動的に閉じます。
3.  次のファイルが自動的に開きます。

これを繰り返し、全てのファイルの処理が完了するとメッセージが表示されます。

---

## 4. 機能詳細解説

### 4.1 番号の自動進行ルール
*   **通常モード**: 配置するたびに数字が **+1** されます（例: 001 → 002）。
*   **A-B分け（サブ文字）モード**:
    *   チェックを入れると、カット番号にアルファベット（A〜Z）が付きます。
    *   配置すると、**数字は増えず、サブ文字が進行**します（例: 001A → 001B）。
    *   **モード終了時**: チェックを外してOFFにすると、**自動的に次番号（数字）が +1** されます（例: 001Bまで打ってOFF → 次は 002）。
        *   *注意: ONにしただけで一度も配置せずにOFFにした場合は、番号は進みません（誤操作防止）。*

### 4.2 背景（塗りつぶし）の挙動
「塗りつぶし」チェックボックスが ON の場合、文字の下にレイヤーが生成されます。
*   **行配置の場合**: 文字の周囲に指定した「範囲拡張(px)」分の余白を持った白背景が作られます。
*   **選択範囲に配置の場合**: 「範囲拡張(px)」の設定は**無視**され、**作成した選択範囲の形（外接矩形）そのままで**塗りつぶされます。

### 4.3 テンプレートの作成と管理
自分の用紙に合わせた設定を作ることができます。

1.  **「使用テンプレート選択」** セクションの下にある **「新規テンプレート作成」** を開きます。
2.  **テンプレ名**: 分かりやすい名前を入力（例: A4縦_4コマ）。
3.  **DPI**: 使用する画像の解像度に合わせます。
4.  **行数**: 1ページあたりのコマ数。
5.  **1コマ目の位置サイズ (XYWH)**:
    *   数値を直接入力するか、キャンバス上で1コマ目の枠を選択範囲で囲み、**「選択範囲からXYWH読取」** ボタンを押すと自動入力されます。
6.  **フォント / サイズ**: 使用するフォントと大きさを指定。
7.  **「テンプレ作成」** ボタンを押すと保存され、リストに追加されます。

*   **削除**: テンプレを削除できます。ユーザー作成テンプレは物理削除、内蔵テンプレは非表示になります。
*   **フォントサイズ同期**: 数値入力とプリセット選択は連動しています。プリセットにないサイズも直接入力可能です（8〜50pt）。
*   **フォント選択**: 初回のみフォント一覧を読み込むため、少し時間がかかる場合があります。未選択時は既定フォント（Arial-Black）が使用されます。

### 4.4 履歴機能（戻る）
間違えて「保存して次へ」を押してしまった場合など、**「戻る」** ボタンで前のファイルに戻れます。
*   戻ると「履歴モード」になり、修正して再度保存できます。
*   最新のファイルまで進むと、自動的に通常のキュー処理に戻ります。

### 4.5 リセット
何らかの理由で動作がおかしくなったり、最初からやり直したい場合は **「リセット」** ボタン（「保存して次へ」の近く、または I/O パネル内）を押してください。
保存されていないファイルがある場合は確認ダイアログが出ます。

---

## 5. ショートカットキー一覧

パネルにフォーカスがある時（トップバーの円が点灯している時）に有効です。

| キー | 動作 | 備考 |
| :--- | :--- | :--- |
| **`1` 〜 `9`** | 指定行（コマ）に番号配置 | テンキーor数字キー / テンプレの行数範囲内のみ有効 |
| **`Enter`** | 保存して次へ | `Cmd+Enter` / `Ctrl+Enter` も可 |

> **注意:** テキストボックスに入力中など、文字入力モードの時はショートカットは無効になります。(誤操作の防止)

---

## 6. よくある質問とトラブルシューティング

**Q. キーボードの `1` を押しても反応しない。**
A. パネルからフォーカスが外れています（Photoshop のキャンバスなどをクリックした後など）。パネル上部の**トップバー（円マーク）をクリック**してください。インジケータの表示は変わりませんがフォーカスがプラグインに復帰します。

**Q. 「保存して次へ」を押しても保存されない。**
A. 出力先フォルダの設定が無効になっている可能性があります。「出力先設定」ボタンから再度フォルダを指定してください。

**Q. 数字がカウントアップしない。**
A. 「A-B分け」にチェックが入っていませんか？ このモード中は数字は固定され、アルファベットのみが進みます。チェックを外すと自動的に数字が +1 されます。

**Q. JPGやPNGも書き出したい。**
A. 「絵コンテ読み込み」セクションの「追加出力」をONにし、形式を選択してください。PSD保存と同時に書き出されます。

**Q. 間違ったところにカット番号を配置してしまった。**
A. Photoshopのレイヤーパネルから当該レイヤーを手動で削除してください。次番号からカットナンバーを正しい数字に直して、再度カット番号を振り直してください。
